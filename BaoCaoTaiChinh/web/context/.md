Kiểm tra các vị trí gọi API trong HTML và JavaScript:

[2 tools called]

Đang tìm các hàm JavaScript gọi API:

[2 tools called]

Tổng hợp các điểm gọi API trong HTML và luồng xử lý:

## Trong HTML (không trực tiếp gọi API)

HTML chỉ có các event handlers gọi hàm JavaScript:

1. Line 21: `onclick="exportData()"` — Xuất dữ liệu
2. Line 41: `onchange="onStockChange()"` — Chọn mã cổ phiếu
3. Line 54: `oninput="onSearchChange()"` — Tìm kiếm chỉ tiêu
4. Lines 63, 67, 71: `onclick="onTabChange('balance'/'cashflow'/'income')"` — Đổi tab báo cáo

## Luồng gọi API

### 1. Khi trang load (tự động)

```
index_detail.html (line 134: <script src="js/app.js">)
    ↓
app.js (line 13-30: DOMContentLoaded → initializeApp())
    ↓
app.js (line 24: loadStocksForReport())
    ↓
app.js (line 49: loadStocks())
    ↓
data.js (line 46: fetch(`${API_BASE}/stocks?table=${tableName}`))
    ↓
API: GET /api/stocks?table=balance_sheet_raw
```

### 2. Khi chọn stock

```
index_detail.html (line 41: onchange="onStockChange()")
    ↓
app.js (line 79-91: onStockChange())
    ↓
app.js (line 90: loadTableDataForStock())
    ↓
app.js (line 127: loadTableData())
    ↓
data.js (line 65: fetch(`${API_BASE}/${reportTypeApi}/table-data?stock=${stock}`))
    ↓
API: GET /api/balance-sheet/table-data?stock=XXX
     hoặc GET /api/income-statement/table-data?stock=XXX
     hoặc GET /api/cash-flow/table-data?stock=XXX
```

### 3. Khi đổi tab

```
index_detail.html (line 63/67/71: onclick="onTabChange(...)")
    ↓
app.js (line 96-118: onTabChange())
    ↓
app.js (line 110: loadStocksForReport()) → API: GET /api/stocks
    ↓
app.js (line 114: loadTableDataForStock()) → API: GET /api/{reportType}/table-data
```

### 4. Khi search (không gọi API, chỉ filter local)

```
index_detail.html (line 54: oninput="onSearchChange()")
    ↓
app.js (line 243-251: onSearchChange())
    ↓
Chỉ filter dữ liệu đã load, KHÔNG gọi API mới
```

### 5. Khi export (không gọi API, chỉ export local data)

```
index_detail.html (line 21: onclick="exportData()")
    ↓
app.js (line 256-263: exportData())
    ↓
data.js (line 138-181: exportToCSV())
    ↓
Chỉ export dữ liệu đã load, KHÔNG gọi API
```

## Vị trí gọi API thực tế

Các API được gọi trong `js/data.js`:

1. Line 46: `fetch(\`${API_BASE}/stocks?table=${tableName}\`)`

   - Hàm: `loadStocks()`
   - API: `GET /api/stocks?table={tableName}`
2. Line 65: `fetch(\`${API_BASE}/${reportTypeApi}/table-data?stock=${stock}\`)`

   - Hàm: `loadTableData()`
   - API: `GET /api/{reportType}/table-data?stock={stock}`

## Tóm tắt

- HTML: Không gọi API trực tiếp, chỉ có event handlers
- JavaScript (app.js): Xử lý events và gọi hàm từ data.js
- JavaScript (data.js): Chứa các hàm gọi API bằng `fetch()`

API được gọi ở 2 vị trí trong `data.js`:

- Line 46: Lấy danh sách stocks
- Line 65: Lấy dữ liệu bảng

Bạn muốn tôi chỉ ra chi tiết từng dòng code không?
